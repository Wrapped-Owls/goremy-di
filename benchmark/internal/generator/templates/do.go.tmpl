{{define "value_call_args"}}{{if .Dependencies}}({{range $index, $dep := .Dependencies}}{{if $index}}, {{end}}{{if $dep.ValueVar}}{{$dep.ValueVar}}{{else}}{{$dep.Type.VarName}}{{end}}{{end}}){{else}}(){{end}}{{end}}

{{define "provider_call_args"}}{{if .Dependencies}}({{range $index, $dep := .Dependencies}}{{if $index}}, {{end}}{{$dep.Type.VarName}}{{end}}){{else}}(){{end}}{{end}}

{{define "op_init_container"}}
	inj := do.New()
{{end}}

{{define "op_register_singleton"}}
	do.Provide(inj, func(i do.Injector) ({{.Type.Type}}, error) {
{{- range .Dependencies }}
		{{.Type.VarName}}, _ := do.Invoke[{{.Type.Type}}](i)
{{- end}}
		return {{.Type.Constructor}}{{template "provider_call_args" .}}, nil
	})
{{end}}

{{define "op_register_factory"}}
	do.ProvideTransient(inj, func(i do.Injector) ({{.Type.Type}}, error) {
{{- range .Dependencies }}
		{{.Type.VarName}}, _ := do.Invoke[{{.Type.Type}}](i)
{{- end}}
		return {{.Type.Constructor}}{{template "provider_call_args" .}}, nil
	})
{{end}}

{{define "op_register_instance"}}
	do.ProvideValue(inj, {{if .ValueVar}}{{.ValueVar}}{{else}}{{.Type.VarName}}{{end}})
{{end}}

{{define "op_create_value"}}
	{{.ValueVar}} := {{.Type.Constructor}}{{template "value_call_args" .}}
{{end}}

{{define "op_retrieve"}}
	_, _ = do.Invoke[{{.Type.Type}}](inj)
{{end}}

{{define "dispatch_op"}}
{{- if eq .Kind "init_container" -}}
	{{template "op_init_container" .}}
{{- else if eq .Kind "register_singleton" -}}
	{{template "op_register_singleton" .}}
{{- else if eq .Kind "register_factory" -}}
	{{template "op_register_factory" .}}
{{- else if eq .Kind "register_instance" -}}
	{{template "op_register_instance" .}}
{{- else if eq .Kind "create_value" -}}
	{{template "op_create_value" .}}
{{- else if eq .Kind "retrieve" -}}
	{{template "op_retrieve" .}}
{{- end}}
{{end}}
