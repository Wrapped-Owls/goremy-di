{{define "value_call_args"}}{{if .Dependencies}}({{range $index, $dep := .Dependencies}}{{if $index}}, {{end}}{{if $dep.ValueVar}}{{$dep.ValueVar}}{{else}}{{$dep.Type.VarName}}{{end}}{{end}}){{else}}(){{end}}{{end}}

{{define "provider_call_args"}}{{if .Dependencies}}({{range $index, $dep := .Dependencies}}{{if $index}}, {{end}}{{$dep.Type.VarName}}{{end}}){{else}}(){{end}}{{end}}

{{define "op_init_container"}}
    inj := do.New()
{{end}}

{{define "op_register_singleton"}}
    do.Provide(inj, func (i do.Injector) ({{.Type.Type}}, error) {
{{- range .Dependencies }}
    {{.Type.VarName}}, _ := do.Invoke[{{.Type.Type}}](i)
{{- end}}
    return {{.Type.Constructor}}{{template "provider_call_args" .}}, nil
})
{{end}}

{{define "op_register_factory"}}
    do.ProvideTransient(inj, func (i do.Injector) ({{.Type.Type}}, error) {
{{- range .Dependencies }}
    {{.Type.VarName}}, _ := do.Invoke[{{.Type.Type}}](i)
{{- end}}
    return {{.Type.Constructor}}{{template "provider_call_args" .}}, nil
})
{{end}}

{{define "op_register_instance"}}
    do.ProvideValue(inj, {{if .ValueVar}}{{.ValueVar}}{{else}}{{.Type.VarName}}{{end}})
{{end}}

{{define "op_create_value"}}
    {{.ValueVar}} := {{.Type.Constructor}}{{template "value_call_args" .}}
{{end}}

{{define "op_retrieve"}}
    if _, err := do.Invoke[{{.Type.Type}}](inj); err != nil {
        b.Fatal(err)
    }
{{end}}

{{define "op_retrieve_ignore_error"}}
    _, _ = do.Invoke[{{.Type.Type}}](inj)
{{end}}
