{{define "op_init_container"}}
	inj := remy.NewInjector()
{{end}}

{{define "remy_constructor_suffix"}}
	{{- $arity := len .Type.Dependencies -}}
	{{- if eq $arity 0 -}}{{- else if eq $arity 1 -}}Args1{{- else if eq $arity 2 -}}Args2{{- else if eq $arity 3 -}}Args3{{- end -}}
{{end}}

{{define "remy_call_args"}}
	{{- if .Dependencies -}}({{range $index, $dep := .Dependencies}}{{if $index}}, {{end}}{{if $dep.ValueVar}}{{$dep.ValueVar}}{{else}}{{$dep.Type.VarName}}{{end}}{{end}}){{else}}(){{end}}
{{end}}

{{define "op_register_singleton"}}
	remy.RegisterConstructor{{template "remy_constructor_suffix" .}}(inj, remy.Singleton[{{.Type.Type}}], {{.Type.Constructor}})
{{end}}

{{define "op_register_factory"}}
	remy.RegisterConstructor{{template "remy_constructor_suffix" .}}(inj, remy.Factory[{{.Type.Type}}], {{.Type.Constructor}})
{{end}}

{{define "op_register_instance"}}
	remy.RegisterInstance(inj, {{if .ValueVar}}{{.ValueVar}}{{else}}{{.Type.VarName}}{{end}})
{{end}}

{{define "op_create_value"}}
	{{.ValueVar}} := {{.Type.Constructor}}{{template "remy_call_args" .}}
{{end}}

{{define "op_retrieve"}}
	_, _ = remy.Get[{{.Type.Type}}](inj)
{{end}}

{{define "dispatch_op"}}
{{- if eq .Kind "init_container" -}}
	{{template "op_init_container" .}}
{{- else if eq .Kind "register_singleton" -}}
	{{template "op_register_singleton" .}}
{{- else if eq .Kind "register_factory" -}}
	{{template "op_register_factory" .}}
{{- else if eq .Kind "register_instance" -}}
	{{template "op_register_instance" .}}
{{- else if eq .Kind "create_value" -}}
	{{template "op_create_value" .}}
{{- else if eq .Kind "retrieve" -}}
	{{template "op_retrieve" .}}
{{- end}}
{{end}}
